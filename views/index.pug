extends layout

block content
  h1= title
  p Welcome to #{title}

  //button(onclick='sayHello()') Send OSC message
  pre#doeSupported
  pre#output

  script(src='public/js/osc-browser.min.js')
  script.
    var port = new osc.WebSocketPort({
      // url: 'ws://localhost:3000'
      url: 'wss://crowdmap.fm'
    });
    port.on('message', function (oscMsg) {
      console.log('Got WS: ', oscMsg);
    });

    port.open();

    var sayHello = function () {
      port.send({
        address: '/test',
        args: ['hopethisworks']
      });
    };

    var output = document.getElementById('output');

    function handleOrientation(event) {
      var absolute = event.absolute;
      var alpha = event.alpha;
      var beta = event.beta;
      var gamma = event.gamma;

      output.innerHTML = 'Beta: ' + beta;

      port.send({
        timeTag: osc.timeTag(0),
        packets: [
          {
            address: '/orientation/alpha',
            args: [{type: 'f', value: alpha}]
          }, {
            address: '/orientation/beta',
            args: [{type: 'f', value: beta}]
          }, {
            address: '/orientation/gamma',
            args: [{type: 'f', value: gamma}]
          }
        ]
      });
    }

    if (window.DeviceOrientationEvent) {
      window.addEventListener('deviceorientation', handleOrientation, false);
      document.getElementById("doeSupported").innerText = "Supported!";
    } else {
      document.getElementById("doeSupported").innerText = "Not supported :(";
    }
